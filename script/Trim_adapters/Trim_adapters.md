# Trim adapters completely

### Adapters
```
$ cat miRNA.fa 
>miRNA-F
AATGATACGGCGACCACCGAGATCTACACGTTCAGAGTTCTACAGTCCGACGATC
>miRNA-F-as
GATCGTCGGACTGTAGAACTCTGAACGTGTAGATCTCGGTGGTCGCCGTATCATT
>miRNA-R
TGGAATTCTCGGGTGCCAAGGAACTCCAGTCAC
>miRNA-R-as
GTGACTGGAGTTCCTTGGCACCCGAGAATTCCA
>miRNA-PCR-R
CAAGCAGAAGACGGCATACGAGAT
>miRNA-PCR-R-as
ATCTCGTATGCCGTCTTCTGCTTG

```

### R1 reads

R1 reads contain **miRNA-R** , index (TATTCGCG) and **miRNA-PCR-R-as** sequences

![R1_read](picture/R1_read.png)

### Test data

test data with different length of adapters

![test_data](picture/test_data.png)

### Trim adapters using SOAPnuke

```
$ /home/zyb/soft/SOAPnuke filter -1 adapter_test.R1.fq -2 adapter_test.R2.fq -f TGGAATTCTCGGGTGCCAAGGAACTCCAGTCAC -r GATCGTCGGACTGTAGAACTCTGAACGTGTAGATCTC --cutAdaptor 30 -o cut -C adapter_filt.R1.fq -D adapter_filt.R2.fq -5 1 -Q 2 -G --misMatch 6 --matchRatio 0.4 
```

output files:

```
$ cat adapter_filt.R1.fq
@E00599:106:HNVVFCCXY:1:1102:11292:46824 1:N:0:TATTCGCG
ATTCTGGCTGTACCGAGTTGTCGATTAACGCTCGCACCCTCTGTATTACCGCGGCTGCTGGCAC
+
AAAFFJJJFJJJJJJJJJJJJJJJJFJJJJFJFJJFAJ<J<JJJJJJJJJFFFFJJJJJJJJJJ
@E00599:106:HNVVFCCXY:1:1102:22729:47017 1:N:0:TATTCGCG
CCTGACGATGTACCGAGTTGTCTCGCGAGCCGGGCGGCGCCGCTCTCGGCACGCGACCTCCGCGCGTTAATGACCCTTCCGCAGGTTCACCTACGGTTACCTTGTTACGAC
+
AAFFFJA-7AAJA-<AFAF<A<-7FFA-AJ<<AFJJF<7A7FFA--A<F7JJFJJ-A<7F77AFFA-A-7A7FJ7A<<<FJAJ-7AA<<F7-FA--F-FAAJFJFAJF--7
@E00599:106:HNVVFCCXY:1:1102:15696:24638 1:N:0:TATTCGCG
ACGATAGATGTACCGAGTTGTGTTAAGCTCAGGGATTTCACATCCGACTTAAAAAGCCGCCTACGCACGCTTTACGCCCAGTAAGTCCGGTTAACGCTCGCACCCTCTGTATTACCGCGGCTGCTGGCAC
+
AAFFFJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJ
```


#### SOAPnuke can not trim short adapter

SOAPnuke trim the adapters based on the parameters **misMatch** and **matchRatio**

* with larger **matchRatio** value, short adapter can not bed trimmed
* with lower **matchRatio** value, valid sequence same to partial adapter may be cut off

![SOAPnuke_trim](picture/SOAPnuke_trim.png)


#### fastp can not trim long adapter

```
$ fastp --in1 adapter_test.R1.fq --in2 adapter_test.R2.fq  --out1 adapter_fastp_trim.R1.fq --out2 adapter_fastp_trim.R2.fq
```


![fastp_trim](picture/fastp_trim.png)


### Trim adapter combining SOAPnuke and fastp

raw reads:

![raw reads](picture/1_raw.png)

#### Trim adapters using **fastp** and then **SOAPnuke**

fastp result:

![fastp result](picture/2_fastp.png)

SOAPnuke result:

![SOAPnuke result](picture/3_SOAPnuke.png)

#### Trim adapters using **SOAPnuke** and then  **fastp**

SOAPnuke result:

![SOAPnuke result](picture/2_SOAPnuke.png)

fastp result:

![fastp result](picture/3_fastp.png)

### Merge PE reads can get clean valid reads

Merge PE reads using usearch
```
 $ usearch -fastq_mergepairs adapter_test.R1.fq -reverse adapter_test.R2.fq -fastqout adapter_test_merge_usearch
```

output file:
```
$ cat  adapter_test_merge_usearch
@E00599:106:HNVVFCCXY:1:1102:15696:24638
ACGATAGATGTACCGAGTTGTGTTAAGCTCAGGGATTTCACATCCGACTTAAAAAGCCGCCTACGCACGCTTTACGCCCAGTAAGTCCGGTTAACGCTCGCACCCTCTGTATTACCGCGGCTGCTGGCAC
+
JJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJ
@E00599:106:HNVVFCCXY:1:1101:15808:9255
ACATGTTAGCAGATCGCACATCAGTCGGTTATTCACCTGACTGGTTTTTTTGATTTGCTTGGGTTGCGTCTAAAAGACCAGAAGCATTTTGATGTTTAAACCGCGGTAATCGTTCCGAGAATACGGTTACCTTGTTACGAC
+
JJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJ
@E00599:106:HNVVFCCXY:1:1102:22729:47017
CCTGACGATGTACCGAGTTGTCTCGCGAGCCGGGCGGCGCCGCTCTCGGCACGCGACCTCCGCGCGTTAATGACCCTTCCGCAGGTTCACCTACGGTTACCTTGTTACGAC
+
JJJJJJJJJJJJJJJJJJJJJJ=JJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJ
@E00599:106:HNVVFCCXY:1:1102:11292:46824
ATTCTGGCTGTACCGAGTTGTCGATTAACGCTCGCACCCTCTGTATTACCGCGGCTGCTGGCAC
+
JJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJ
```

Merge reads can completely trim the adapters

